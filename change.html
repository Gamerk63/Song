<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Surprise</title>

<style>
body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #ffe0ec, #fff0d9);
    text-align: center;
    overflow: hidden;
}

.container {
    width: 100%;
    max-width: 360px;
    padding: 20px;
    position: relative;
}

.hidden {
    display: none;
}

img {
    max-width: 100%;
    border-radius: 14px;
    margin: 15px 0;
}

/* Bouquet blending */
.bouquet {
    mix-blend-mode: multiply;
    filter: contrast(1.1) saturate(1.15);
}

button {
    padding: 12px 26px;
    font-size: 16px;
    border: none;
    border-radius: 25px;
    background-color: #ff4f7b;
    color: white;
    cursor: pointer;
    margin-top: 15px;
}

/* BALLOON */
.balloon-wrapper {
    position: relative;
    height: 300px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.balloon {
    width: 130px;
    height: 165px;
    background: radial-gradient(circle at 30% 30%, #ffd1ff, #ff4fd8);
    border-radius: 50%;
    position: relative;
    animation: float 3s ease-in-out infinite;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255,79,216,0.4);
}

/* Thread */
.balloon::after {
    content: "";
    position: absolute;
    bottom: -80px;
    left: 50%;
    width: 2px;
    height: 80px;
    background: #444;
    transform: translateX(-50%);
}

/* Ribbon knot */
.ribbon-knot {
    position: absolute;
    bottom: -20px;
    left: 50%;
    width: 26px;
    height: 16px;
    background: #ff2f6d;
    border-radius: 4px;
    transform: translateX(-50%);
}

.ribbon-knot::before,
.ribbon-knot::after {
    content: "";
    position: absolute;
    top: 50%;
    width: 18px;
    height: 10px;
    background: #ff2f6d;
    border-radius: 4px;
}

.ribbon-knot::before {
    left: -14px;
    transform: rotate(-25deg);
}

.ribbon-knot::after {
    right: -14px;
    transform: rotate(25deg);
}

@keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-25px); }
    100% { transform: translateY(0); }
}

/* POP EFFECT */
.pop {
    animation: pop 0.35s forwards;
}

@keyframes pop {
    to {
        transform: scale(2);
        opacity: 0;
    }
}

/* SPARKLES */
.sparkle {
    position: absolute;
    width: 8px;
    height: 8px;
    background: radial-gradient(circle, #fff, #ffd700);
    border-radius: 50%;
    animation: sparkle 0.8s ease-out forwards;
}

@keyframes sparkle {
    to {
        transform: translate(var(--x), var(--y)) scale(0);
        opacity: 0;
    }
}

.gifts img {
    width: 120px;
    margin: 10px;
}
.birthday-text {
    position: relative;
    z-index: 20;
    margin-bottom: 130px;
}
.next-btn {
    position: relative;
    z-index: 20;
    margin-top: 140px;
}
.cake {
    position: absolute;
    width: 250px;
    height: 200px;
    top: 50%;
    left: 50%;
    margin-top: -70px;
    margin-left: -125px;
    z-index: 5;
}

.cake > * {
    position: absolute;
}

/* ================= PLATE ================= */

.plate {
    width: 270px;
    height: 110px;
    bottom: -10px;
    left: -10px;
    background-color: #ccc;
    border-radius: 50%;
    box-shadow:
        0 2px 0 #b3b3b3,
        0 4px 0 #b3b3b3,
        0 5px 40px rgba(0,0,0,0.5);
}

/* ================= CAKE LAYERS ================= */

.layer {
    width: 250px;
    height: 100px;
    border-radius: 50%;
    background-color: #553c13;
    box-shadow:
        0 2px 0 #60451a,
        0 4px 0 #4c3410,
        0 6px 0 #4a320f,
        0 8px 0 #482f0f,
        0 10px 0 #462d0e,
        0 12px 0 #442b0d,
        0 14px 0 #42290d,
        0 16px 0 #40270c,
        0 18px 0 #3e250c,
        0 20px 0 #3c230b;
}

.layer-top { top: 0; }
.layer-middle { top: 33px; }
.layer-bottom { top: 66px; }

/* ================= ICING ================= */

.icing {
    top: 2px;
    left: 5px;
    width: 240px;
    height: 90px;
    background-color: #f0e4d0;
    border-radius: 50%;
    z-index: 5;
}

.icing::before {
    content: "";
    position: absolute;
    top: 4px;
    right: 5px;
    bottom: 6px;
    left: 5px;
    background-color: #f4ead8;
    border-radius: 50%;
    box-shadow: 0 0 6px #fff;
}

/* ================= DRIPS ================= */

.drip {
    width: 50px;
    height: 60px;
    background-color: #f0e4d0;
    border-bottom-left-radius: 25px;
    border-bottom-right-radius: 25px;
    z-index: 4;
}

.drip1 {
    top: 53px;
    left: 5px;
    transform: skewY(15deg);
    width: 40px;
    height: 48px;
}

.drip2 {
    top: 69px;
    left: 181px;
    transform: skewY(-15deg);
}

.drip3 {
    top: 54px;
    left: 90px;
    width: 80px;
    border-bottom-left-radius: 40px;
    border-bottom-right-radius: 40px;
}

/* ================= CANDLE ================= */

.candle {
    width: 16px;
    height: 50px;
    background-color: #7B020B;
    border-radius: 8px / 4px;
    top: -20px;
    left: 50%;
    margin-left: -8px;
    z-index: 10;
}

.candle::before {
    content: "";
    position: absolute;
    top: 0;
    width: 16px;
    height: 8px;
    border-radius: 50%;
    background-color: #9a020f;
}

/* ================= FLAME ================= */

.flame {
    position: absolute;
    width: 15px;
    height: 35px;
    background-color: orange;
    border-radius: 10px 10px 10px 10px / 25px 25px 10px 10px;
    top: -34px;
    left: 50%;
    margin-left: -7.5px;
    transform-origin: 50% 90%;
    animation: flicker 1s ease-in-out infinite alternate;
    box-shadow:
        0 0 10px rgba(255,165,0,0.5),
        0 0 30px rgba(255,165,0,0.5),
        0 0 60px rgba(255,165,0,0.5);
}

@keyframes flicker {
    0% { transform: skewX(5deg); }
    50% { transform: skewX(-10deg); }
    100% { transform: skewX(5deg); }
}
.cake-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
    position: relative;
}
#confetti {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 10;
}

.img-section {
    margin-bottom: 25px;
    text-align: left;
}

.img-section h3 {
    margin: 0 0 10px 10px;
    font-size: 18px;
    color: #ff4f7b;
}

.image-scroll {
    display: flex;
    gap: 14px;
    overflow-x: auto;
    padding: 10px;
    width: 100vw;
    box-sizing: border-box;
}

.image-scroll img {
    height: 220px;
    border-radius: 14px;
    flex-shrink: 0;
    cursor: pointer;
    transition: transform 0.25s ease;
}

.image-scroll img:hover {
    transform: scale(1.05);
}

#step5 {
    height: 100vh;
    overflow-y: auto;
    padding-top: 60px;   /* pushes content below task bar */
    box-sizing: border-box;
}
.img-section:first-child {
    margin-top: 10px;
}
.decorations {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 120px;
    z-index: 30;
    pointer-events: none;
}

.string {
    position: absolute;
    top: 0;
    width: 120%;
    height: 80px;
    border-bottom: 4px solid #ff4f7b;
    border-radius: 0 0 100% 100%;
}

.s1 {
    left: -10%;
    border-color: #ff4f7b;
}

.s2 {
    left: -5%;
    top: 20px;
    border-color: #ffa502;
}

.s3 {
    left: -15%;
    top: 40px;
    border-color: #2ed573;
}
#step8 {
    position: fixed;
    inset: 0;
    background: black;
    z-index: 999;

    display: none;          /* IMPORTANT */
    justify-content: center;
    align-items: center;
}

.back-btn {
    position: absolute;
    top: 20px;
    left: 20px;

    padding: 10px 18px;
    border-radius: 20px;
    border: none;
    background: #ff4f7b;
    color: white;
    font-size: 14px;
    cursor: pointer;
    z-index: 1000;
}
.cake-wish {
    margin-top: 20px;
    top:120px;
    position:relative;
    z-index:20;
    font-size: 18px;
    color: #ff4f7b;
    text-align: center;
    line-height: 1.4;
}
#step5 .next-btn {
    margin-top: 30px;   
    margin-bottom: 60px;/* reduce space, moves button up */
}

/* ================= BOOK CARD (from card.html) ================= */

.book {
    width: 320px;
    height: 420px;
    position: relative;
    perspective: 1600px;
    margin: auto;
}

.cover {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(180deg, #ff7ea0, #ff4f7b);
    border-radius: 14px;
    transform-origin: left center;
    transform-style: preserve-3d;
    transition: transform 1s ease;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 2;

    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
}

.page {
    position: absolute;
    width: 100%;
    height: 100%;
    background: #fff;
    border-radius: 14px;
    box-shadow: inset 10px 0 25px rgba(0,0,0,0.1);
    z-index: 1;
    padding: 26px;
    box-sizing: border-box;
}

.book.open .cover {
    transform: rotateY(-160deg);
}

.cover h1 {
    font-size: 28px;
    text-align: center;
}

.cover span {
    display: block;
    font-size: 14px;
    margin-top: 10px;
    opacity: 0.9;
}

.page h2 {
    color: #ff4f7b;
    margin-bottom: 12px;
}

.page p {
    font-size: 15px;
    line-height: 1.6;
    color: #333;
}

</style>
</head>

<body>

<!-- Flower overlay styles (scoped to #flowerOverlay) -->
<style>
/* Scoped flower animation CSS from test.html, prefixed with #flowerOverlay to avoid conflicts */
#flowerOverlay { position: fixed; inset: 0; display: none; justify-content: center; align-items: flex-end; background: transparent; perspective: 1000px; z-index: 9999; }

/* RESET scoped */
#flowerOverlay *,
#flowerOverlay *::before,
#flowerOverlay *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

#flowerOverlay .night {
    position: fixed;
    inset: 0;
    background:
        radial-gradient(ellipse at top, transparent 0%, #000),
        radial-gradient(ellipse at bottom, #000, rgba(145,233,255,.25)),
        linear-gradient(90deg, rgb(0,255,250), rgb(240,240,240));
    filter: blur(0.1vmin);
}

#flowerOverlay .flowers {
    position: relative;
    transform: scale(1.15);
}

#flowerOverlay .flower {
    position: absolute;
    bottom: -5vmin;
    transform-origin: bottom center;
}

#flowerOverlay .flower--1 { animation-name: moving-flower-1; }
#flowerOverlay .flower--2 {
    left: 50%;
    transform: rotate(20deg);
    animation-name: moving-flower-2;
}
#flowerOverlay .flower--3 {
    left: 50%;
    transform: rotate(-15deg);
    animation-name: moving-flower-3;
}

#flowerOverlay .flower__leafs {
    position: relative;
    animation: blooming-flower 2s backwards;
}

#flowerOverlay .flower__leafs--1 { animation-delay: 1.1s; }
#flowerOverlay .flower__leafs--2 { animation-delay: 1.4s; }
#flowerOverlay .flower__leafs--3 { animation-delay: 1.7s; }

#flowerOverlay .flower__leaf {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 8vmin;
    height: 11vmin;
    background: linear-gradient(to top, #54b8aa, #a7ffee);
    border-radius: 50%;
    transform-origin: bottom center;
    opacity: 0.9;
}

#flowerOverlay .flower__leaf--1 { transform: translate(-10%, 1%) rotateY(40deg) rotateX(-50deg); }
#flowerOverlay .flower__leaf--2 { transform: translate(-50%, -4%) rotateX(40deg); }
#flowerOverlay .flower__leaf--3 { transform: translate(-90%, 0%) rotateY(45deg) rotateX(50deg); }
#flowerOverlay .flower__leaf--4 {
    width: 8vmin;
    height: 8vmin;
    transform: translate(0, 18%) rotateX(70deg) rotate(-43deg);
}

#flowerOverlay .flower__white-circle {
    position: absolute;
    top: -3vmin;
    left: -3.5vmin;
    width: 9vmin;
    height: 4vmin;
    background: white;
    border-radius: 50%;
}

#flowerOverlay .flower__line {
    width: 1.8vmin;
    height: 80vmin;
    background: linear-gradient(to top, transparent 5%, #14757a, #39c6d6);
    animation: grow-flower-tree 4s backwards;
}

#flowerOverlay .flower__line__leaf {
    position: absolute;
    width: 7vmin;
    height: 9vmin;
    background: linear-gradient(to top, rgba(20,117,122,.4), #39c6d6);
    border-radius: 100%;
}

#flowerOverlay .flower__line__leaf--1 { top: 20%; left: 90%; transform: rotate(70deg); }
#flowerOverlay .flower__line__leaf--2 { top: 45%; left: 90%; transform: rotate(70deg); }
#flowerOverlay .flower__line__leaf--3 { top: 12%; left: -460%; transform: rotate(-70deg); }
#flowerOverlay .flower__line__leaf--4 { top: 40%; left: -460%; transform: rotate(-70deg); }

#flowerOverlay .flower__light {
    position: absolute;
    bottom: 0;
    width: 1vmin;
    height: 1vmin;
    background: yellow;
    border-radius: 50%;
    animation: light-ans 4s linear infinite;
}

#flowerOverlay .flower__light:nth-child(odd) { background: #23f0ff; }

#flowerOverlay .flower__light--1 { left: -2vmin; animation-delay: 1s; }
#flowerOverlay .flower__light--2 { left: 3vmin; animation-delay: .5s; }
#flowerOverlay .flower__light--3 { left: -6vmin; animation-delay: .3s; }
#flowerOverlay .flower__light--4 { left: 6vmin; animation-delay: .9s; }
#flowerOverlay .flower__light--5 { left: -1vmin; animation-delay: 1.5s; }
#flowerOverlay .flower__light--6 { left: -4vmin; animation-delay: 3s; }
#flowerOverlay .flower__light--7 { left: 3vmin; animation-delay: 2s; }
#flowerOverlay .flower__light--8 { left: -6vmin; animation-delay: 3.5s; }

#flowerOverlay .grow-ans {
    animation: grow-ans 2s var(--d) backwards;
}

/* KEYFRAMES (kept global names to preserve animation behavior) */
@keyframes grow-ans {
    from { transform: scale(0); opacity: 0; }
}

@keyframes light-ans {
    0% { opacity: 0; transform: translateY(0); }
    50% { opacity: 1; transform: translateY(-15vmin); }
    100% { opacity: 0; transform: translateY(-30vmin); }
}

@keyframes blooming-flower {
    from { transform: scale(0); }
}

@keyframes grow-flower-tree {
    from { height: 0; }
}

@keyframes moving-flower-1 {
    0%,100% { transform: rotate(2deg); }
    50% { transform: rotate(-2deg); }
}

@keyframes moving-flower-2 {
    0%,100% { transform: rotate(18deg); }
    50% { transform: rotate(14deg); }
}

@keyframes moving-flower-3 {
    0%,100% { transform: rotate(-18deg); }
    50% { transform: rotate(-20deg); }
}

#flowerOverlay.not-loaded * { animation-play-state: paused !important; }

</style>

<!-- Style the flower overlay Close button to match the provided pill design -->
<style>
#closeFlower {
    position: absolute;
    top: 14px;
    right: 20px;
    left: auto;
    z-index: 10001;
    padding: 8px 20px;
    border-radius: 24px;
    background: linear-gradient(180deg, #ff7ea0, #ff4f7b);
    color: #ffffff;
    border: none;
    font-size: 15px;
    font-weight: 600;
    line-height: 1;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    display: inline-flex;
    align-items: center;
    justify-content: center;
}
#closeFlower:hover { transform: translateY(-1px); }
</style>

<div class="container">

    <!-- Step 1 -->
    <div id="step1">
        <img src="https://static-assets-prod.fnp.com/images/pr/l/v20201026205505/scarlet-rose-fantasy-bouquet_1.jpg" class="bouquet"
        onerror="this.onerror=null; this.src='https://github.com/Gamerk63/Song/raw/refs/heads/main/Front%20bouquet.webp';">
        
        <h2>Hey Gorgeous üå∏</h2>
        <p>I‚Äôve been waiting for you.<br>This is for you.</p>
        <button onclick="nextStep(2)">Go ahead</button>
    </div>

    <!-- Step 2 -->
    <div id="step2" class="hidden">
        <h2>I have something for you üéÅ</h2>
        <p>Want to reveal it?</p>
        <button onclick="nextStep(3)">Reveal</button>
    </div>

    <!-- Step 3 -->
    <div id="step3" class="hidden">
        <p>Pop the balloon üéà</p>
        <div class="balloon-wrapper">
            <div class="balloon" onclick="popBalloon(this)">
                
            </div>
        </div>
    </div>

    <!-- Step 4 -->
<div id="step4" class="hidden">
<div id="decorations" class="hidden decorations">
    <div class="string s1"></div>
    <div class="string s2"></div>
    <div class="string s3"></div>
</div>
    <h2 class="birthday-text">Happy Birthday üéÇ</h2>

    <!-- Cake from xyz.html -->
    <div class="cake-wrapper">
        <div class="cake">
            <div class="plate"></div>

            <div class="layer layer-bottom"></div>
            <div class="layer layer-middle"></div>
            <div class="layer layer-top"></div>

            <div class="icing"></div>
            <div class="drip drip1"></div>
            <div class="drip drip2"></div>
            <div class="drip drip3"></div>

            <div class="candle">
                <div class="flame"></div>
            </div>
        </div>
    </div>
    <p class="cake-wish">
    May your day be as sweet as this cake and your year full of smiles üíñ
</p>
    <button class="next-btn" onclick="nextStep(9)">Card üíå</button>
</div>


<!-- STEP 9 : Birthday Card -->
<div id="step9" class="hidden">

    <!-- Card -->
    <div class="book" onclick="openBook(this)">
        
        <div class="cover">
            <div>
                <h1>Happy Birthday üéÇ</h1>
                <span>Tap to open</span>
            </div>
        </div>

        <div class="page">
            <h2>Dear You üíñ</h2>
            <p>
                On your special day, I just want you to know<br>
            how much you mean and how special you are.<br><br>
            May your year be filled with love, laughter,<br>
            and moments that make you smile ‚ú®
            </p>
        </div>

    </div>

    <!-- Button OUTSIDE the card -->
    <button class="next-btn"
            style="margin-top:30px;"
            onclick="goToGifts()">
        Gifts üéÅ
    </button>

</div>

    <!-- Step 5 -->
<div id="step5" class="hidden">
    <h2>For You üíñ</h2>

    <!-- Section 1 -->
    <div class="img-section">
        <h3>Teddy's üêª</h3>
        <div class="image-scroll">
            <img src="https://m.media-amazon.com/images/I/61GFbDB6saL._AC_UF1000,1000_QL80_FMwebp_.jpg" >
            <img src="https://m.media-amazon.com/images/I/71A0AFUk97L._AC_UF1000,1000_QL80_FMwebp_.jpg">
            <img src="https://m.media-amazon.com/images/I/51iaZJwi7yL._AC_UF1000,1000_QL80_FMwebp_.jpg">
            <img src="https://m.media-amazon.com/images/I/81OWQ+qpqTL._AC_UF1000,1000_QL80_FMwebp_.jpg">
            <img src="https://m.media-amazon.com/images/I/613z3DEs0wL._AC_UF1000,1000_QL80_FMwebp_.jpg">
            <img src="https://m.media-amazon.com/images/I/613ls1KV-HL._AC_UF1000,1000_QL80_FMwebp_.jpg">
        </div>
    </div>

    <!-- Section 2 -->
    <div class="img-section">
        <h3>Ornaments ‚ú®Ô∏è</h3>
        <div class="image-scroll">
            <img src="https://rukminim2.flixcart.com/image/768/768/xif0q/earring/b/j/b/na-0f48-er-jv-creation-original-imahbzvfhvshpfwd.jpeg?q=90">
            <img src="https://m.media-amazon.com/images/I/61NRGHMjSmL._AC_UY1000_.jpg" >
            <img src="https://m.media-amazon.com/images/I/81lqWXU03gL._AC_UY1100_FMwebp_.jpg">
            <img src="https://adn-static1.nykaa.com/nykdesignstudio-images/pub/media/catalog/product/2/6/2633c10ESSK121_NYFR1_1.jpg?rnd=20200526195200&tr=w-900">
            <img src="https://jewelsmars.com/cdn/shop/files/WhatsAppImage2025-12-27at12.28.45PM.jpg?v=1767005879" >
            <img src="https://m.media-amazon.com/images/I/91zOmciscUL._AC_UY1100_FMwebp_.jpg">
            <img src="https://rukminim2.flixcart.com/image/768/768/xif0q/earring/d/m/n/na-stylish-silver-plated-jhumkas-set-of-4-pairs-earrings-for-original-imahfn9dhdrucghr.jpeg?q=90">
        </div>
    </div>

    <!-- Section 3 -->
    <div class="img-section">
        <h3>Flowers üåπ</h3>
        <div class="image-scroll">
        <img src="https://i.pinimg.com/736x/55/7b/6f/557b6f52d1d2d644f0b1b3b06388b036.jpg" >
        <img src="https://nanthavanathil.in/wp-content/uploads/2022/06/images-2022-06-27T091918.537.jpeg" >
            <img src="https://hips.hearstapps.com/hmg-prod/images/mixed-flower-bouquet-royalty-free-image-1728336500.jpg?crop=0.696xw:1.00xh;0.154xw,0&resize=1120:*" >
            <img src="https://cdn2.stylecraze.com/wp-content/uploads/2013/07/Beautiful-Flowers-360x405.jpg.avif" >
            <img src="https://hips.hearstapps.com/hmg-prod/images/close-up-of-red-rose-royalty-free-image-672727875-1546363000.jpg?crop=0.384xw:0.719xh;0.306xw,0.242xh&resize=1200:*" >
            <img src="https://cdn.pixabay.com/photo/2023/01/05/13/34/rose-7698947_1280.jpg" >
            <img src="https://cdn.pixabay.com/photo/2018/04/18/08/59/flower-3329845_1280.jpg" >
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcREVQy2F-BQo0m1YaZq_xYWv9X_0K2H0T1-IG1jgwjSug&s=10" >
        </div>
    </div>
    
    <!-- Section 4 -->
    <div class="img-section">
        <h3>Chocolates üç´</h3>
        <div class="image-scroll">
        <img src="https://static-assets-prod.fnp.com/images/pr/l/v20240311180245/eternal-love-chocolate-bouquet_1.jpg">
        <img src="https://m.media-amazon.com/images/I/81BOVlia1sL._AC_UF894,1000_QL80_FMwebp_.jpg">
        <img src="https://m.media-amazon.com/images/I/71bPlPINRdL._AC_UF894,1000_QL80_FMwebp_.jpg">
        <img src="https://m.media-amazon.com/images/I/619XPjMyesL._AC_UF894,1000_QL80_FMwebp_.jpg">
        <img src="https://static-assets-prod.fnp.com/images/pr/l/v20180518122234/three-layer-chocolaty-wishes_1.jpg">
        <img src="https://rukminim2.flixcart.com/image/768/768/xif0q/festive-gift-box/o/e/l/12-7-explosion-box-birthday-gift-8-chocolate-zigzag-photo-folder-original-imah97kg5pj6ypys.jpeg?q=90">
        </div>
        </div>

    <button class="next-btn" onclick="nextStep(6)">More</button>
</div>

<!-- Step 6 : Gift Selection -->
<div id="step6" class="hidden">
    <h2>Choose Your Gift üíù</h2>
    <style>
    .gift-row button { width: 90px; padding: 12px 0; }
    </style>

    <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin-top:30px;">
        <div class="gift-row" style="display:flex; gap:20px;">
            <button onclick="openHeart()">‚ù§Ô∏è</button>
            <button onclick="selectGift('üß∏ Teddy')">üß∏</button>
            <button onclick="selectGift('üå∏ Flower')">üå∏</button>
        </div>
        <button id="joybtn" class="gift-btn" onclick="openJoy()" target="_blank">Kinder Joy üéÅ</button>
    </div>

    <p id="giftText" style="margin-top:25px; font-size:18px;"></p>

    <button class="next-btn" onclick="nextStep(7)">Finally</button>
</div>

    <!-- Step 7 -->
    <div id="step7" class="hidden">
        <h3>Once again üíï</h3>
        <h1>Happy Birthday üéâ</h1>
        <h2>Take care of yourself üòä</h2>
    </div>
    
    <!-- Step 8 : Heart Animation -->
<div id="step8">
    <button class="back-btn" onclick="goBack()">Close</button>
    <canvas id="heart"></canvas>
</div>

</div>

<audio id="popSound">
    <source src="https://github.com/Gamerk63/Song/raw/refs/heads/main/balloon-pop-48030.mp3">
</audio>

<audio id="cakeMusic" loop>
    <source src="https://github.com/Gamerk63/Song/raw/refs/heads/main/happy-birthday-254480.mp3">
</audio>

<audio id="flowerMusic" loop>
    <source src="https://github.com/Gamerk63/Song/raw/refs/heads/main/Flower%20instrumental.mp3">
</audio>

<audio id="heartMusic" loop>
    <source src="https://github.com/Gamerk63/Song/raw/refs/heads/main/Heart%20instrumental.mp3">
</audio>

<audio id="moreMusic" loop>
    <source src="https://github.com/Gamerk63/Song/raw/refs/heads/main/More%20instrumental.mp3">
</audio>

<audio id="teddyMusic" loop>
    <source src="https://github.com/Gamerk63/Song/raw/refs/heads/main/Teddy%20instrumental.mp3">
</audio>


<canvas id="confetti" class="hidden"></canvas>

<!-- Panda overlay (hidden until Teddy selected) -->
<div id="pandaOverlay" class="hidden" style="position:fixed;inset:0;display:none;background:rgba(0,0,0,0.55);z-index:10000;">
    <button id="closePanda" class="back-btn" style="right:20px;left:auto;z-index:10001;">Close</button>
    <canvas id="pandaCanvas" style="position:absolute;inset:0;width:100vw;height:100vh;border-radius:0;background:#fff0e0;box-shadow:none;z-index:10000;"></canvas>
</div>

<script>

function stopAllMusic() {
    const ids = [
        "cakeMusic",
        "flowerMusic",
        "heartMusic",
        "moreMusic",
        "teddyMusic"
    ];

    ids.forEach(id => {
        const a = document.getElementById(id);
        if (a) {
            a.pause();
            a.currentTime = 0;
        }
    });
}


function nextStep(step) {
    for (let i = 1; i <= 8; i++) {
        const el = document.getElementById("step" + i);
        if (el) el.classList.add("hidden");
    }

document.getElementById("step8").style.display = "none";

    document.getElementById("step" + step).classList.remove("hidden");

    if (step === 4) {
    startConfetti();
    decorate();

    const music = document.getElementById("cakeMusic");
    music.volume = 0.5;
    music.play();
} else {
    stopConfetti();

    const music = document.getElementById("cakeMusic");
    music.pause();
    music.currentTime = 0;
}

if (step === 5) {
    stopAllMusic();
    const music = document.getElementById("moreMusic");
    music.volume = 0.4;
    music.play();
}
}

function popBalloon(balloon) {
    // play pop sound immediately
    document.getElementById("popSound").play();
    const music = document.getElementById("cakeMusic");
    music.volume = 0.5;

    setTimeout(() => {
        music.play();
    }, 700); // delay in ms

    balloon.classList.add("pop");

    for (let i = 0; i < 14; i++) {
        const s = document.createElement("div");
        s.className = "sparkle";
        s.style.left = "50%";
        s.style.top = "50%";
        s.style.setProperty("--x", `${Math.random()*200-100}px`);
        s.style.setProperty("--y", `${Math.random()*-200}px`);
        balloon.parentElement.appendChild(s);
        setTimeout(() => s.remove(), 800);
    }

    setTimeout(() => {
        nextStep(4);
    }, 500);
}

const canvas = document.getElementById("confetti");
const ctx = canvas.getContext("2d");

function resizeConfetti() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeConfetti();
window.addEventListener("resize", resizeConfetti);

let confettiPieces = [];
const colors = ["#ff4757", "#ffa502", "#1e90ff", "#2ed573", "#e84393", "#f9ca24"];
let confettiRunning = false;

function initConfetti() {
    confettiPieces = [];
    for (let i = 0; i < 200; i++) {
        confettiPieces.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height - canvas.height,
            w: 8,
            h: 12,
            color: colors[Math.floor(Math.random() * colors.length)],
            speed: Math.random() * 2 + 2,
            tilt: Math.random() * 10 - 5
        });
    }
}

function drawConfetti() {
    if (!confettiRunning) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    confettiPieces.forEach(c => {
        ctx.save();
        ctx.translate(c.x, c.y);
        ctx.rotate(c.tilt * Math.PI / 180);
        ctx.fillStyle = c.color;
        ctx.fillRect(-c.w / 2, -c.h / 2, c.w, c.h);
        ctx.restore();

        c.y += c.speed;
        c.x += Math.sin(c.y * 0.05);
        c.tilt += 0.5;

        if (c.y > canvas.height) {
            c.y = -20;
            c.x = Math.random() * canvas.width;
        }
    });

    requestAnimationFrame(drawConfetti);
}

function startConfetti() {
    resizeConfetti();
    canvas.classList.remove("hidden");
    confettiRunning = true;
    initConfetti();
    drawConfetti();
}

function stopConfetti() {
    confettiRunning = false;
    canvas.classList.add("hidden");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}
function decorate() {
    document.getElementById("decorations").classList.remove("hidden");
    document.getElementById("decorateBtn").classList.add("hidden");
    document.getElementById("lightBtn").classList.remove("hidden");
}
function selectGift(gift) {
    // Don't show the "You chose ..." text for Teddy or Flower selections
    if (typeof gift === 'string' && (gift.includes('Teddy') || gift.includes('Flower'))) {
        document.getElementById("giftText").innerText = "";
    } else {
        document.getElementById("giftText").innerText =
            "You chose " + gift + " just for you üíñ";
    }

    // If Teddy selected, show the panda overlay
    if (typeof gift === 'string' && gift.includes('Teddy')) {
        showPandaOverlay();
    }
    // If Flower selected, show the flower overlay
    if (typeof gift === 'string' && gift.includes('Flower')) {
        showFlowers();
    }
}

function openHeart() {
    stopAllMusic();

    const music = document.getElementById("heartMusic");
    music.volume = 0.45;
    music.play();

    nextStep(8);
    document.getElementById("step8").style.display = "flex";
}

(function () {

const canvas = document.getElementById("heart");
if (!canvas) return;   // safety

const ctx = canvas.getContext("2d");

let width, height, dpr;
const HEART_VERTICAL_OFFSET = 0.18; // 18% of height

function resize() {
    dpr = window.devicePixelRatio || 1;

    const VIRTUAL_WIDTH = 1200;
    const VIRTUAL_HEIGHT = 800;

    // Scale to fit screen while keeping aspect ratio
    const scale = Math.min(
        window.innerWidth / VIRTUAL_WIDTH,
        window.innerHeight / VIRTUAL_HEIGHT
    );

    width = VIRTUAL_WIDTH;
    height = VIRTUAL_HEIGHT;

    canvas.width = width * dpr;
    canvas.height = height * dpr;

    canvas.style.width = (width * scale) + "px";
    canvas.style.height = (height * scale) + "px";

    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, width, height);
}

window.addEventListener("resize", resize);

const rand = Math.random;

function heartPosition(rad) {
    return [
        Math.pow(Math.sin(rad), 3),
        -(15 * Math.cos(rad)
        - 5 * Math.cos(2 * rad)
        - 2 * Math.cos(3 * rad)
        - Math.cos(4 * rad))
    ];
}

function scaleAndTranslate(pos, sx, sy, dx, dy) {
    return [dx + pos[0] * sx, dy + pos[1] * sy];
}

const traceCount = 50;
const dr = 0.1;

let pointsOrigin = [];
for (let i = 0; i < Math.PI * 2; i += dr)
    pointsOrigin.push(scaleAndTranslate(heartPosition(i), 210, 13, 0, 0));
for (let i = 0; i < Math.PI * 2; i += dr)
    pointsOrigin.push(scaleAndTranslate(heartPosition(i), 150, 9, 0, 0));
for (let i = 0; i < Math.PI * 2; i += dr)
    pointsOrigin.push(scaleAndTranslate(heartPosition(i), 90, 5, 0, 0));

const heartPointsCount = pointsOrigin.length;
let targetPoints = [];

let heartCenterY = 0;
for (let i = 0; i < pointsOrigin.length; i++) {
    heartCenterY += pointsOrigin[i][1];
}
heartCenterY /= pointsOrigin.length;

function pulse(kx, ky) {
    for (let i = 0; i < pointsOrigin.length; i++) {
        targetPoints[i] = [
            kx * pointsOrigin[i][0] + width / 2,
            ky * (pointsOrigin[i][1] - heartCenterY) + height / 2
        ];
    }
}

let particles = [];
for (let i = 0; i < heartPointsCount; i++) {
    let x = rand() * window.innerWidth;
    let y = rand() * window.innerHeight;

    let trace = [];
    for (let k = 0; k < traceCount; k++) trace.push({ x, y });

    particles.push({
        vx: 0,
        vy: 0,
        speed: rand() + 5,
        q: Math.floor(rand() * heartPointsCount),
        D: 2 * (i % 2) - 1,
        force: 0.2 * rand() + 0.7,
        color: `hsla(0,${Math.floor(40 * rand() + 60)}%,${Math.floor(60 * rand() + 20)}%,.3)`,
        trace
    });
}

let time = 0;

function loop() {

    if (document.getElementById("step8").classList.contains("hidden")) {
        requestAnimationFrame(loop);
        return;
    }

    if (!width) resize();

    const n = -Math.cos(time);
    pulse((1 + n) * 0.5, (1 + n) * 0.5);

    time += ((Math.sin(time) < 0 ? 9 : n > 0.8 ? 0.2 : 1) * 0.01);

    ctx.fillStyle = "rgba(0,0,0,0.1)";
    ctx.fillRect(0, 0, width, height);

    for (let p of particles) {
        const q = targetPoints[p.q];
        let dx = p.trace[0].x - q[0];
        let dy = p.trace[0].y - q[1];
        let length = Math.sqrt(dx * dx + dy * dy) || 1;

        if (length < 10) {
            if (rand() > 0.95) p.q = Math.floor(rand() * heartPointsCount);
            else p.q = (p.q + p.D + heartPointsCount) % heartPointsCount;
        }

        p.vx += (-dx / length) * p.speed;
        p.vy += (-dy / length) * p.speed;

        p.trace[0].x += p.vx;
        p.trace[0].y += p.vy;

        p.vx *= p.force;
        p.vy *= p.force;

        for (let k = 0; k < p.trace.length - 1; k++) {
            p.trace[k + 1].x -= 0.4 * (p.trace[k + 1].x - p.trace[k].x);
            p.trace[k + 1].y -= 0.4 * (p.trace[k + 1].y - p.trace[k].y);
        }

        ctx.fillStyle = p.color;
        for (let t of p.trace) ctx.fillRect(t.x, t.y, 1, 1);
    }

    requestAnimationFrame(loop);
}

loop();

})();
function goBack() {
stopAllMusic();
    document.getElementById("step8").style.display = "none";
    nextStep(6);   // goes back to gift selection
}

</script>
<script>
(function(){
 const pandaOverlay = document.getElementById('pandaOverlay');
 const pandaCanvas = document.getElementById('pandaCanvas');
 if (!pandaOverlay || !pandaCanvas) return;
 const pandaCtx = pandaCanvas.getContext('2d');

 let panda_running = false;
 let panda_t = 0;
 let pandaEyeScale = 2.4;
 const pandaBaseEyeScale = 2.4;
 let pandaHolding = false;
 let pandaOffsetX = 0, pandaOffsetY = 0, pandaStartX = 0, pandaStartY = 0, pandaDragging = false;
 let pandaRAF = null;
 let pandaDpr = window.devicePixelRatio || 1;

 function resizePanda() {
     pandaDpr = window.devicePixelRatio || 1;
     // use bounding rect to get the rendered size
     const rect = pandaCanvas.getBoundingClientRect();
     const w = Math.max(300, Math.floor(rect.width));
     const h = Math.max(300, Math.floor(rect.height));
     // set backing store size in device pixels
     pandaCanvas.width = Math.max(300, Math.floor(w * pandaDpr));
     pandaCanvas.height = Math.max(300, Math.floor(h * pandaDpr));
     // reset transform and scale to device pixels
     pandaCtx.setTransform(1, 0, 0, 1, 0, 0);
     pandaCtx.scale(pandaDpr, pandaDpr);
 }

 function startPandaDrag(x, y) {
     pandaDragging = true;
     pandaHolding = true;
     pandaStartX = x - pandaOffsetX;
     pandaStartY = y - pandaOffsetY;
 }

 function movePandaDrag(x, y) {
     if (!pandaDragging) return;
     pandaOffsetX = x - pandaStartX;
     pandaOffsetY = y - pandaStartY;
     pandaOffsetX = Math.max(-120, Math.min(120, pandaOffsetX));
     pandaOffsetY = Math.max(-160, Math.min(160, pandaOffsetY));
 }

 function endPandaDrag() {
     pandaDragging = false;
     pandaHolding = false;
 }

 function drawPandaFrame() {
     // clear using CSS pixels (canvas is scaled by dpr)
     const cssW = pandaCanvas.width / Math.max(1, pandaDpr);
     const cssH = pandaCanvas.height / Math.max(1, pandaDpr);
     pandaCtx.clearRect(0, 0, cssW, cssH);
     pandaCtx.save();
     pandaCtx.translate(pandaOffsetX, pandaOffsetY);
     pandaCtx.translate(pandaCanvas.width / pandaDpr / 2 - 210, pandaCanvas.height / pandaDpr / 2 - 260);
     const cx = 210;
     const squish = Math.sin(panda_t * 0.05) * 4;

     if (pandaHolding) {
         pandaEyeScale += 0.18; // grow faster when held
         if (pandaEyeScale > 6.0) pandaEyeScale = 6.0; // larger cap
     } else {
         pandaEyeScale += (pandaBaseEyeScale - pandaEyeScale) * 0.35; // return to base faster
     }

     const ctx = pandaCtx;
     // BODY
     ctx.fillStyle = "#f4a261";
     ctx.beginPath();
     ctx.ellipse(cx, 360, 100 + squish, 130 - squish, 0, 0, Math.PI * 2);
     ctx.fill();

     // ARMS
     ctx.fillStyle = "#e76f51";
     ctx.beginPath();
     ctx.ellipse(120, 345, 34, 70, 0.4, 0, Math.PI * 2);
     ctx.ellipse(300, 345, 34, 70, -0.4, 0, Math.PI * 2);
     ctx.fill();

     // LEGS
     ctx.beginPath();
     ctx.ellipse(165, 475, 40, 28, 0, 0, Math.PI * 2);
     ctx.ellipse(255, 475, 40, 28, 0, 0, Math.PI * 2);
     ctx.fill();

     // HEAD
     ctx.fillStyle = "#ffd6a5";
     ctx.beginPath();
     ctx.ellipse(cx, 175, 98, 86, 0, 0, Math.PI * 2);
     ctx.fill();

     // EARS
     ctx.fillStyle = "#e76f51";
     ctx.beginPath();
     ctx.arc(125, 95, 30, 0, Math.PI * 2);
     ctx.arc(295, 95, 30, 0, Math.PI * 2);
     ctx.fill();

     // EYE PATCHES
     ctx.fillStyle = "#e76f51";
     ctx.beginPath();
     ctx.ellipse(170, 175, 30, 36, 0, 0, Math.PI * 2);
     ctx.ellipse(250, 175, 30, 36, 0, 0, Math.PI * 2);
     ctx.fill();

    // EYES (larger when popped) and shift outward from center
    const delta = Math.max(0, pandaEyeScale - pandaBaseEyeScale);
    const eyeShift = delta * 6; // pixels to move eyes away from center per scale delta
    const leftEyeX = 170 - eyeShift;
    const rightEyeX = 250 + eyeShift;
    ctx.fillStyle = "#ffffff";
    ctx.beginPath();
    ctx.arc(leftEyeX, 175, 10 * pandaEyeScale, 0, Math.PI * 2);
    ctx.arc(rightEyeX, 175, 10 * pandaEyeScale, 0, Math.PI * 2);
    ctx.fill();

    // PUPILS (shift slightly more for a stronger pop-out effect)
    const pupilShift = delta * 7;
    ctx.fillStyle = "#3a2a1a";
    ctx.beginPath();
    ctx.arc(leftEyeX - pupilShift * 0.1, 178, 5.2 * pandaEyeScale, 0, Math.PI * 2);
    ctx.arc(rightEyeX + pupilShift * 0.1, 178, 5.2 * pandaEyeScale, 0, Math.PI * 2);
    ctx.fill();

     // NOSE
     ctx.beginPath();
     ctx.arc(cx, 202, 6, 0, Math.PI * 2);
     ctx.fill();

     // MOUTH
     ctx.strokeStyle = "#3a2a1a";
     ctx.lineWidth = 3;
     ctx.beginPath();
     ctx.arc(cx, 212, 18, 0, Math.PI);
     ctx.stroke();

     ctx.restore();
 }

 function pandaLoop() {
     if (!panda_running) return;
     panda_t++;
     if (!pandaDragging) { pandaOffsetX *= 0.9; pandaOffsetY *= 0.9; }
     drawPandaFrame();
     pandaRAF = requestAnimationFrame(pandaLoop);
 }

 function showPandaOverlay() {
     if (!pandaOverlay || !pandaCanvas) return;
    // reset state and make visible
    pandaOffsetX = 0; pandaOffsetY = 0; panda_t = 0; pandaEyeScale = 2.1;
    pandaOverlay.classList.remove('hidden');
    pandaOverlay.style.display = 'flex';
    
    stopAllMusic();

const music = document.getElementById("teddyMusic");
music.volume = 0.4;
music.play();
    // ensure layout applied before sizing
    requestAnimationFrame(() => {
        resizePanda();
        panda_running = true;
        drawPandaFrame();
        // attach events
        pandaCanvas.addEventListener('mousedown', panda_onMouseDown);
        window.addEventListener('mousemove', panda_onMouseMove);
        window.addEventListener('mouseup', panda_onMouseUp);
        pandaCanvas.addEventListener('touchstart', panda_onTouchStart, { passive: false });
        window.addEventListener('touchmove', panda_onTouchMove, { passive: false });
        window.addEventListener('touchend', panda_onTouchEnd);
        window.addEventListener('resize', resizePanda);
        pandaLoop();
    });
 }

 function hidePandaOverlay() {
 stopAllMusic();
    pandaOverlay.classList.add('hidden');
    pandaOverlay.style.display = 'none';
     panda_running = false;
     // remove events
     pandaCanvas.removeEventListener('mousedown', panda_onMouseDown);
     window.removeEventListener('mousemove', panda_onMouseMove);
     window.removeEventListener('mouseup', panda_onMouseUp);
     pandaCanvas.removeEventListener('touchstart', panda_onTouchStart);
     window.removeEventListener('touchmove', panda_onTouchMove);
     window.removeEventListener('touchend', panda_onTouchEnd);
     window.removeEventListener('resize', resizePanda);
     if (pandaRAF) cancelAnimationFrame(pandaRAF);
 }

 // Event handlers (scoped)
 function panda_onMouseDown(e) { startPandaDrag(e.clientX, e.clientY); }
 function panda_onMouseMove(e) { movePandaDrag(e.clientX, e.clientY); }
 function panda_onMouseUp() { endPandaDrag(); }
 function panda_onTouchStart(e) { e.preventDefault(); const t = e.touches[0]; startPandaDrag(t.clientX, t.clientY); }
 function panda_onTouchMove(e) { e.preventDefault(); const t = e.touches[0]; movePandaDrag(t.clientX, t.clientY); }
 function panda_onTouchEnd() { endPandaDrag(); }

 // Wire close button
 document.getElementById('closePanda').addEventListener('click', hidePandaOverlay);

 // expose to global (so selectGift can call it)
 window.showPandaOverlay = showPandaOverlay;
 window.hidePandaOverlay = hidePandaOverlay;
})();
</script>
<script>
(function(){
})();
</script>
<!-- Flower overlay HTML (copied from test.html, scoped) -->
<div id="flowerOverlay" class="not-loaded" aria-hidden="true">
    <button id="closeFlower" class="back-btn" style="right:20px;left:auto;z-index:10001;">Close</button>
    <div class="night"></div>

    <div class="flowers">

        <!-- FLOWER 2 -->
        <div class="flower flower--2">
            <div class="flower__leafs flower__leafs--2">
                <div class="flower__leaf flower__leaf--1"></div>
                <div class="flower__leaf flower__leaf--2"></div>
                <div class="flower__leaf flower__leaf--3"></div>
                <div class="flower__leaf flower__leaf--4"></div>
                <div class="flower__white-circle"></div>

                <div class="flower__light flower__light--3"></div>
                <div class="flower__light flower__light--4"></div>
                <div class="flower__light flower__light--5"></div>
                <div class="flower__light flower__light--6"></div>
                <div class="flower__light flower__light--7"></div>
                <div class="flower__light flower__light--8"></div>
            </div>

            <div class="flower__line">
                <div class="flower__line__leaf flower__line__leaf--1"></div>
                <div class="flower__line__leaf flower__line__leaf--2"></div>
                <div class="flower__line__leaf flower__line__leaf--3"></div>
                <div class="flower__line__leaf flower__line__leaf--4"></div>
            </div>
        </div>

        <!-- FLOWER 3 -->
        <div class="flower flower--3">
            <div class="flower__leafs flower__leafs--3">
                <div class="flower__leaf flower__leaf--1"></div>
                <div class="flower__leaf flower__leaf--2"></div>
                <div class="flower__leaf flower__leaf--3"></div>
                <div class="flower__leaf flower__leaf--4"></div>
                <div class="flower__white-circle"></div>

                <div class="flower__light flower__light--1"></div>
                <div class="flower__light flower__light--2"></div>
                <div class="flower__light flower__light--3"></div>
                <div class="flower__light flower__light--4"></div>
                <div class="flower__light flower__light--5"></div>
                <div class="flower__light flower__light--6"></div>
                <div class="flower__light flower__light--7"></div>
                <div class="flower__light flower__light--8"></div>
            </div>

            <div class="flower__line">
                <div class="flower__line__leaf flower__line__leaf--1"></div>
                <div class="flower__line__leaf flower__line__leaf--2"></div>
                <div class="flower__line__leaf flower__line__leaf--3"></div>
                <div class="flower__line__leaf flower__line__leaf--4"></div>
            </div>
        </div>

        <!-- GROWING ELEMENTS -->
        <div class="grow-ans" style="--d:1.2s">
            <div class="flower__g-long">
                <div class="flower__g-long__top"></div>
                <div class="flower__g-long__bottom"></div>
            </div>
        </div>

        <div class="grow-ans" style="--d:3s"><div class="leaf leaf--2"></div></div>
        <div class="grow-ans" style="--d:3.6s"><div class="leaf leaf--3"></div></div>

    </div>

</div>

<script>
// Helper functions to show/hide the flower overlay without interfering with existing scripts
function showFlowers() {
    stopAllMusic();

    const music = document.getElementById("flowerMusic");
    music.volume = 0.4;
    music.play();

    const ov = document.getElementById('flowerOverlay');
    if (!ov) return;
    ov.style.display = 'flex';
    setTimeout(() => ov.classList.remove('not-loaded'), 1000);
}
function hideFlowers() {
stopAllMusic();
    const ov = document.getElementById('flowerOverlay');
    if (!ov) return;
    ov.classList.add('not-loaded');
    setTimeout(() => ov.style.display = 'none', 600);
}
// wire flower close button like the panda close button
try {
    const cf = document.getElementById('closeFlower');
    if (cf) cf.addEventListener('click', hideFlowers);
} catch (e) { /* ignore if not present during parse */ }
</script>
<script>
function openBook(book) {
    book.classList.toggle("open");
}

function goToGifts() {
    // hide card step completely
    document.getElementById("step9").classList.add("hidden");

    // open original gifts step
    nextStep(5);
}

</script>

<script>
function openJoy() {
    sessionStorage.setItem("returnStep", "6");
    window.location.href = "https://gamerk63.github.io/Song/joy.html";
}

window.addEventListener("load", () => {
    const step = sessionStorage.getItem("returnStep");
    if (step) {
        nextStep(parseInt(step, 10));
        sessionStorage.removeItem("returnStep");
    }
});
</script>
<script>
window.addEventListener("DOMContentLoaded", () => {
    const step = sessionStorage.getItem("returnStep");

    if (step) {
        // hide all steps forcefully
        for (let i = 1; i <= 9; i++) {
            const el = document.getElementById("step" + i);
            if (el) el.classList.add("hidden");
        }

        // show required step
        const target = document.getElementById("step" + step);
        if (target) target.classList.remove("hidden");

        sessionStorage.removeItem("returnStep");
    }
});
</script>

</body>
</html>